<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SRPG Engine</title>
    <style>
        body {
            background: #202020; margin: 0; 
            height: 100vh; height: 100dvh; 
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif; color: white;
        }
        
        .game-wrapper {
            position: relative; width: 100%; height: 100%;
        }

        /* 게임 화면 (초기엔 숨김) */
        #game-screen { display: none; width: 100%; height: 100%; }
        canvas { background: #000; display: block; width: 100%; height: 100%; cursor: crosshair; }

        /* [신규] 병영 화면 스타일 */
        #barracks-screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; height: 100%; background: #222; z-index: 100;
        }
        .barracks-container {
            width: 90%; max-width: 500px; background: #333; padding: 20px;
            border-radius: 10px; border: 2px solid #555; text-align: center;
        }
        .roster-list {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
            margin: 20px 0; max-height: 50vh; overflow-y: auto;
        }
        .roster-item {
            background: #444; padding: 10px; border-radius: 5px; cursor: pointer;
            border: 2px solid transparent; display: flex; justify-content: space-between; align-items: center;
        }
        .roster-item.selected { border-color: #00ff00; background: #2a4a2a; }
        .roster-item.fixed { border-color: #ffcc00; opacity: 0.8; cursor: not-allowed; }
        
        .deploy-btn {
            padding: 15px 30px; font-size: 18px; font-weight: bold;
            background: #ffcc00; color: #000; border: none; border-radius: 5px; cursor: pointer;
        }
        .deploy-btn:disabled { background: #555; color: #888; cursor: not-allowed; }

        /* 기존 UI 스타일들 ... */
        #turn-indicator { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px; font-weight: bold; pointer-events: none; z-index: 15; border: 1px solid #777; }
        #zoom-controls { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; z-index: 15; }
        .zoom-btn { width: 35px; height: 35px; background: rgba(0,0,0,0.6); border: 1px solid #777; color: white; font-size: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center; user-select: none; }
        #action-menu, #skill-menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(40,40,40,0.95); border: 2px solid #ffcc00; border-radius: 8px; padding: 10px; display: none; flex-direction: column; gap: 8px; z-index: 20; min-width: 140px; }
        .menu-btn { background: #555; color: white; border: 1px solid #777; padding: 10px; cursor: pointer; text-align: center; }
        #game-ui { position: absolute; bottom: 0; left: 0; width: 100%; height: 20%; background: rgba(0,0,0,0.9); border-top: 1px solid #555; box-sizing: border-box; display: flex; padding: 5px 10px; justify-content: space-between; align-items: center; pointer-events: none; z-index: 10; }
        .unit-info { display: flex; flex-direction: column; gap: 2px; width: 35%; }
        .hp-bar-bg { width: 100%; height: 6px; background: #333; border: 1px solid #555; border-radius: 2px; }
        .hp-bar-fill { width: 100%; height: 100%; background: #00ff00; transition: width 0.2s; }
        .mp-bar-bg { width: 100%; height: 4px; background: #222; border: 1px solid #444; border-radius: 2px; }
        .mp-bar-fill { width: 100%; height: 100%; background: #0088ff; transition: width 0.2s; }
        .stats-info { display: flex; gap: 8px; font-size: 12px; font-weight: bold; width: 35%; justify-content: center; }
        .terrain-info { text-align: right; width: 25%; }
        
        @media (max-width: 500px) { .stats-info { display: none; } .unit-info { width: 60%; } .terrain-info { width: 35%; } }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div id="barracks-screen">
            <div class="barracks-container">
                <h2 style="color:#ffcc00; margin:0;">출진 부대 편성</h2>
                <p id="deploy-count" style="color:#aaa; font-size:14px;">선택: 1 / 4</p>
                
                <div class="roster-list" id="roster-list">
                    </div>

                <button class="deploy-btn" id="btn-deploy">출진 하기</button>
            </div>
        </div>

        <div id="game-screen">
            <canvas id="gameCanvas"></canvas>
            
            <div id="turn-indicator">TURN: PLAYER</div>
            <div id="zoom-controls">
                <div class="zoom-btn" id="btn-zoom-in">+</div>
                <div class="zoom-btn" id="btn-zoom-out">-</div>
            </div>

            <div id="action-menu">
                <div class="menu-title">행동 선택</div>
                <button class="menu-btn" id="btn-attack">공격</button>
                <button class="menu-btn" id="btn-magic">책략</button>
                <button class="menu-btn" id="btn-wait">대기</button>
            </div>

            <div id="skill-menu">
                <div class="menu-title">책략 선택</div>
                <button class="menu-btn" onclick="cancelSkill()">취소</button>
            </div>

            <div id="game-ui">
                <div class="unit-info" id="ui-unit-panel" style="opacity: 0;">
                    <div class="unit-name" id="ui-name">-</div>
                    <div class="unit-class" id="ui-class">-</div>
                    <div class="hp-bar-bg"><div class="hp-bar-fill" id="ui-hp-bar"></div></div>
                    <div class="mp-bar-bg"><div class="mp-bar-fill" id="ui-mp-bar"></div></div>
                </div>
                <div class="stats-info" id="ui-stats-panel" style="opacity: 0;">
                    <div class="stat-box"><span>공격</span><div id="ui-atk">0</div></div>
                    <div class="stat-box"><span>정신</span><div id="ui-int">0</div></div>
                    <div class="stat-box"><span>방어</span><div id="ui-def">0</div></div>
                </div>
                <div class="terrain-info">
                    <div class="terrain-name" id="ui-terrain">-</div>
                    <div id="ui-terrain-effect" style="font-size:10px; color:#aaa;">-</div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { GameManager } from './js/core/GameManager.js';
        const game = new GameManager();
        game.init(); // 이제 바로 전투 시작 안 하고 병영 로드
        window.cancelSkill = () => game.openActionMenu(); 
    </script>
</body>
</html>